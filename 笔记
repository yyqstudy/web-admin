

æ¥åˆ°ä¸»é¡µï¼Œä¸€åˆ·æ–°ï¼Œè¡¨å•é‡å¤æäº¤ï¼Œå†æ¬¡æ¥åˆ°ç™»å½•é¡µé¢
è§£å†³ï¼šä¸»é¡µåˆ·æ–°è¿˜åœ¨ä¸»é¡µ--redirecté‡å®šå‘

å¦‚ä½•è§£å†³ç™»å½•æˆåŠŸ--è¦åœ¨ä¸»é¡µä½œåˆ¤æ–­
1ã€å†™ä¸€ä¸ªClass User
2ã€ç„¶åå»login.htmlçš„formè¡¨å•ï¼Œæ·»åŠ userNameå’Œpassword--formè¡¨å•æäº¤ä¼šæŠŠuserNameå’Œpasswordå¸¦ä¸Š
3ã€ åœ¨IndexControlleré‚£é‡Œ
    String username,String passwordå°è£…æˆClass User ï¼Œç™»å½•æˆåŠŸæŠŠå®ƒä»¬æ”¾åœ¨Sessioné‡Œé¢
    ç¬¬ä¸€ä¸ªåˆ¤æ–­userNameå’Œpasswordéƒ½ä¸ä¸ºç©ºï¼Œå°±è¯´æ˜ç™»å½•æˆåŠŸ
     session.setAttributeæŠŠç™»å½•æˆåŠŸçš„ç”¨æˆ·å­˜èµ·æ¥
     ç™»å½•æˆåŠŸ--ä¸»é¡µ
     ç™»å½•å¤±è´¥--å›åˆ°ç™»å½•é¡µé¢
     ä¸€èˆ¬ç™»å½•å¤±è´¥ä¼šæœ‰æç¤ºä¿¡æ¯--å¼•å…¥Model-- model.addAttribute("msg","è´¦å·æˆ–å¯†ç é”™è¯¯");
     è½¬å‘å›åˆ°ç™»å½•é¡µé¢ï¼Œæ‰€ä»¥æŠŠç™»å½•é¡µé¢è¦å»çš„æ‰€æœ‰å†…å®¹æ”¾åœ¨Modelé‡Œé¢
       ||  ||
       ||  ||
        \\ //
     ç¬¬äºŒä¸ªåˆ¤æ–­
     å»mainé¡µé¢ï¼š æ¥åˆ°åå°é¡µé¢è¦ä½œåˆ¤æ–­ï¼Œæ˜¯å¦ç™»å½•äº†ï¼Œé˜²æ­¢æ²¡æœ‰ç™»å½•çš„å°±ç›´æ¥è®¿é—®åˆ°mainé¡µé¢
        ||  ||
        ||  ||
         \\ //
     æŠŠloginé¡µé¢çš„é”™è¯¯æç¤ºä¿¡æ¯å–å‡ºæ¥--login.html
     <label style="color:red " th:text="${msg}"></label>
        ||  ||
        ||  ||
         \\ //
     ç™»å½•æˆåŠŸåï¼Œä¸»é¡µè¦æ˜¾ç¤ºç”¨æˆ·åå­—--åœ¨mainé¡µé¢ä¿®æ”¹
     <!--ä¿®æ”¹ç”¨æˆ·åï¼Œä½†æ˜¯ç”¨æˆ·åä¸åœ¨æ ‡ç­¾å†…ï¼Œç›´æ¥æ˜¯htmlæ–‡æœ¬-->
         <!--John Doe-->
      [[${session.logUser.userName}]]

========================Dash Tableså››ä¸ªå­é¡µé¢============================
   å¸Œæœ›èƒ½ç‚¹å‡»Dash Tablesèƒ½æ˜¾ç¤ºå®ƒå››ä¸ªå­é¡µé¢
     ||  ||
     ||  ||
      \\ //
   templatesä¸‹é¢æ–°å»ºä¸€ä¸ªtableï¼Œç”¨æ¥æ”¾tableç›¸å…³çš„é¡µé¢
   ç„¶ååˆ›å»ºtableController,ç”¨æ¥å¤„ç†tableä¸‹é¢çš„é¡µé¢è·³è½¬
   å…ˆå†™å››ä¸ªæ–¹æ³•ï¼Œæ¥åˆ°å››ä¸ªä¸åŒtableé¡µé¢
   è¿™å››ä¸ªhtmlé¡µé¢è®°å¾—åŠ ä¸Šxmlns:th="http://www.thymeleaf.org
        ||  ||
        ||  ||
         \\ //
   å¸Œæœ›ç®€æ´ä¿®æ”¹é¡µé¢è·³è½¬è·¯å¾„--ä»¥ååªåœ¨ä¸€ä¸ªcommon é¡µé¢ä¿®æ”¹è·¯å¾„å³å¯ï¼š basic_table.htmlæ”¹æˆbasic_table
   æ¯ä¸ªé¡µé¢å…¬å…±éƒ¨åˆ†æŠ½å–æ”¾åˆ°ä¸€ä¸ªcommoné¡µé¢
           ||  ||
          ||  ||
           \\ //
   æ€ä¹ˆæŠ½å–å…¬å…±å†…å®¹:ä¸¤ç§æ–¹æ³•ï¼ˆth:fragmentå’Œé€‰æ‹©å™¨idï¼‰
   æ–¹æ³•ä¸€
   Template Layout
   æŠ½å–
    <div th:fragment="copy">
        &copy; 2011 The Good Thymes Virtual Grocery
      </div>
   å¼•ç”¨çš„æ—¶å€™<div th:insert="~{footer :: copy}"></div>

   æ–¹æ³•äºŒ
   æŠ½å–<div id ="commonscript"></div>
   å¼•ç”¨:<div th:replace="common :: #commonscript"></div>


=========================é¡µé¢ä¿®æ”¹bug===================
åœ¨common.html
1ã€ç‚¹å‡»å·¦ä¾§èœå•çš„Dashboardè·³è½¬åˆ°mainé¡µé¢è€Œä¸æ˜¯é»˜è®¤çš„index
   <li><a th:href="@{/main.html}"><i class="fa fa-home"></i> <span>Dashboard</span></a></li>
2ã€åœ¨é¡µé¢å³ä¾§æ˜¾ç¤ºç™»å½•åå­—
  <!--John Doeé¡µé¢å³ä¾§æ˜¾ç¤ºç™»å½•åå­—-->
   [[${session.logUser.userName}]]

3ã€å³ä¸Šè§’çš„logoutä¸€ç‚¹å‡»å°±å›åˆ°loginé¡µé¢
  <li><a th:href="@{/}"><i class="fa fa-sign-out"></i> Log Out</a></li>

4ã€åœ¨Advanced Tableé‡Œé¢æœ‰ä¸€ä¸ªè¡¨æ ¼ï¼Œè¡¨æ ¼å†…å®¹æ˜¯åŠ¨æ€éå†å‡ºæ¥çš„ è€Œä¸æ˜¯å†™æ­»çš„ ---
    TableControllerä¸­çš„dynamic_table()
              //è¡¨æ ¼å†…å®¹çš„éå†--ä¾‹å­ï¼šUserä¸ºä¾‹
              //åˆ›å»ºUserå¯¹è±¡
              List<User> users = Arrays.asList(new User("alex","11111"),
                            new User("alisa","11333"),
                             new User("lucy","aaabb"),
                              new User("sylia","77777"));
              //æŠŠUserå¯¹è±¡æ”¾åœ¨modelé‡Œé¢ï¼ˆä¹Ÿå°±æ˜¯è¯·æ±‚åŸŸé‡Œé¢ï¼‰: usersæ˜¯List<User> users,èµ‹å€¼ç»™"users"
              model.addAttribute("users",users);

   ç„¶ååœ¨dynamic_table.htmlæŠŠ<tr></tr>é‡Œé¢çš„å†…å®¹åˆ æ‰ï¼Œä¸è¦è¿™äº›å†™æ­»çš„ï¼Œè€Œæ˜¯è¦åŠ¨æ€éå†çš„
   éå†çŠ¶æ€ï¼ˆåŒ…æ‹¬ç´¢å¼•ï¼‰ä¿®æ”¹


   <!--è¡¨æ ¼å†…å®¹çš„éå†å‡ºæ¥çš„-->
   <!--model.addAttribute("users",users);-->
    <tr class="gradeX" th:each="user:${users}">
      <td>Trident</td>
     <!--å–å‡ºç”¨æˆ·åå’Œå¯†ç ï¼šä¸¤ç§æ–¹æ³•-->
     <td th:text="${user.userName}"></td>
     <td>[[${user.password}]]</td>

=========================æ‹¦æˆªå™¨===================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶ï¼šLoginInterceptor.java   AdminWebConfig.java

åœ¨controllerä¹‹å‰æˆ–è€…ä¹‹åå¹²ç‚¹äº‹æƒ…
åˆ›å»ºä¸€ä¸ªLoginInterceptor,ç»§æ‰¿æ¥å£HandlerInterceptor--ç™»å½•æ£€æŸ¥
         ||  ||
         ||  ||
          \\ //
è¦æŠŠå†™å¥½çš„LoginInterceptoré‡Œé¢çš„æ–¹æ³•æ”¾åœ¨IOCå®¹å™¨ä¸­--åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶AdminWebConfigï¼Œç»§æ‰¿æ¥å£WebMvcConfigurer
               --æŠŠè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å†™åœ¨é‡Œé¢
                 ä½†æ˜¯è¦æ³¨æ„æ”¾è¡Œçš„è·¯å¾„è¦åŒ…æ‹¬staticä¸‹é¢çš„ï¼Œå¦åˆ™é¡µé¢ä¼šå¾ˆä¸‘
ğŸŒŸè€Œä¸”æœ‰äº†æ‹¦æˆªå™¨ï¼Œä¹‹å‰åœ¨IndexControlleré‡Œé¢å»mainé¡µé¢çš„ç™»å½•æ£€æŸ¥å°±ä¸éœ€è¦äº†


1ã€ç¼–å†™ä¸€ä¸ªæ‹¦æˆªå™¨å®ç°HandlerInterceptoræ¥å£
2ã€æ‹¦æˆªå™¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼ˆå®ç°WebMvcConfigurerçš„addInterceptorsï¼‰
3ã€æŒ‡å®šæ‹¦æˆªè§„åˆ™ã€å¦‚æœæ˜¯æ‹¦æˆªæ‰€æœ‰ï¼Œé™æ€èµ„æºä¹Ÿä¼šè¢«æ‹¦æˆªã€‘


=========================æ–‡ä»¶ä¸Šä¼ =======================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶ï¼šform_layouts.htmlã€FormController.java
Formsä¸­çš„form_layouts.html
åˆ›å»ºFormController
è®°å¾—åœ¨common.htmlæ”¹ä¸€ä¸‹èœå•åœ°å€    <li><a th:href="@{form_layouts.html}"> Form Layouts</a></li>
           ||  ||
           ||  ||
            \\ //
         å»form_layouts.html

      <!--æ–‡ä»¶ä¸Šä¼ è¡¨å• ä¸Šä¼ è¯·æ±‚é“¾æ¥-->
      <form role="form" th:action="@{/upload}" method="post" enctype="multipart/form-data">

          <!--å•æ–‡ä»¶ä¸Šä¼ -->
           <div class="form-group">
                <label for="exampleInputFile">å¤´åƒ</label>
                <input type="file" name="headerImg" id="exampleInputFile">
           </div>
           <!--å¤šæ–‡ä»¶ä¸Šä¼ -->
           <div class="form-group">
                <label for="exampleInputFile">ç”Ÿæ´»ç…§</label>
                <input type="file" name="photos" multiple>
           </div>

             ||  ||
             ||  ||
             \\ //
     å»controllerå¤„ç†ä¸Šä¼ è¯·æ±‚
     1ã€ä»è¯·æ±‚å‚æ•°ä¸­è·å–ä»¥ä¸‹
            * @RequestParam("email") String email,
            * @RequestParam("username") String username,
            * @RequestPart("headerImg")MultipartFile headerImg,
            * @RequestPart("photos")MultipartFile photos
     2ã€æ—¥å¿—æ‰“å°æ£€æŸ¥ä¸Šä¼ çš„å€¼å¯¹ä¸å¯¹,ä¿è¯åŸºæœ¬ä¿¡æ¯è·å–åˆ°ï¼Œä¸‹ä¸€æ­¥æ˜¯å¦‚ä½•å°†è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨
     3ã€å¦‚ä½•å°†è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨

=========================é”™è¯¯å¤„ç†=======================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:TableController.java , 404.html , 5xx.html
1ã€é»˜è®¤è§„åˆ™
é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootæä¾›/errorå¤„ç†æ‰€æœ‰é”™è¯¯çš„æ˜ å°„
å¯¹äºæœºå™¨å®¢æˆ·ç«¯ï¼Œå®ƒå°†ç”ŸæˆJSONå“åº”ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯ï¼ŒHTTPçŠ¶æ€å’Œå¼‚å¸¸æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ã€‚
å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå“åº”ä¸€ä¸ªâ€œ whitelabelâ€é”™è¯¯è§†å›¾ï¼Œä»¥HTMLæ ¼å¼å‘ˆç°ç›¸åŒçš„æ•°æ®

 åœ¨TableControllerä¸­basic_table()å†™ä¸€ä¸ªint i = 10/0;æµ‹è¯•é”™è¯¯å¤„ç†
   ä½†æ˜¯æƒ³è‡ªå®šä¹‰é”™è¯¯é¡µ
    ||  ||
    ||  ||
     \\ //
 åœ¨templatesæ–‡ä»¶å¤¹ä¸‹æ–°å»ºerrorï¼Œç”¨æ¥å­˜æ”¾é”™è¯¯é¡µé¢ï¼š 404.htmlå’Œ5xx.html,å¹¶ä¸”åŠ ä¸Š xmlns:th="http://www.thymeleaf.org"
   ||  ||
   ||  ||
    \\ //
åœ¨404.htmlé‡Œé¢ï¼Œç‚¹å‡»Back To HomeæŒ‰é’®å›åˆ°mainé¡µé¢  <a class="back-btn" th:href="@{main.html}"> Back To Home</a>
åœ¨5xx.htmlæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼šå¦‚ä½•å–å‡ºé”™è¯¯ä¿¡æ¯å¹¶æ‰“å°å‡ºæ¥ï¼Ÿ
 <h3 th:text="${message}">Something went wrong.</h3>
 <p class="nrml-txt" th:text="${trace}">Why not try refreshing you page? Or you can <a href="#">contact our support</a> if the problem persists.</p>


=======================WebåŸç”Ÿç»„ä»¶æ³¨å…¥ï¼ˆServletã€Filterã€Listenerï¼‰=======================

ğŸŒŸServletæ³¨å…¥
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶ï¼šMyServlet.java  WebAdminApplication

@ServletComponentScan(basePackages = "com.example.admin") :æŒ‡å®šåŸç”ŸServletç»„ä»¶éƒ½æ”¾åœ¨com.example.admin
@WebServlet(urlPatterns = "/my")ï¼šæ•ˆæœï¼šç›´æ¥å“åº”ï¼Œæ²¡æœ‰ç»è¿‡Springçš„æ‹¦æˆªå™¨ï¼Œä¸ç”¨ç™»å½•ç›´æ¥å¯ä»¥è®¿é—®http://localhost:8080/my

æ–°å»ºä¸€ä¸ªservletæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªMyServlet
   ||  ||
   ||  ||
    \\ //
 @WebServlet(urlPatterns = "/my")è¦ç”Ÿæ•ˆï¼Œè¦åœ¨WebAdminApplicationä¸­æ·»åŠ @ServletComponentScan


ğŸŒŸFilteræ³¨å…¥ -- ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: MyFilter.java WebAdminApplication
@WebFilter(urlPatterns={"/css/*","/images/*"}) + @ServletComponentScan

æ­¥éª¤ï¼šservletæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªMyFilter


ğŸŒŸListeneræ³¨å…¥ç›‘å¬ -- ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:MyServletContextListener.java WebAdminApplication
@WebListener + @ServletComponentScan

æ­¥éª¤ï¼šservletæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªMyServletContextListener


========æ–¹æ³•äºŒï¼šä½¿ç”¨RegistrationBean ========
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:MyRegistConfig.java
ServletRegistrationBean, FilterRegistrationBean,  ServletListenerRegistrationBean

æ­¥éª¤ï¼š
ç°åœ¨æŠŠåˆšåˆšçš„æ³¨è§£ï¼š@WebListener @WebFilter  @WebServletéƒ½æ³¨é‡Šæ‰
   ||  ||
   ||  ||
    \\ //
æ–°å»ºMyRegistConfig.java



Filterä½œç”¨
è¿‡æ»¤å™¨JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒä¸Servletå¾ˆç›¸ä¼¼ï¼è¿‡æ»¤å™¨æ˜¯ç”¨æ¥æ‹¦æˆªè¯·æ±‚çš„ï¼Œè€Œä¸æ˜¯å¤„ç†è¯·æ±‚çš„ã€‚
å½“ç”¨æˆ·è¯·æ±‚æŸä¸ªServletæ—¶ï¼Œä¼šå…ˆæ‰§è¡Œéƒ¨ç½²åœ¨è¿™ä¸ªè¯·æ±‚ä¸Šçš„Filterï¼Œ
å¦‚æœFilterâ€œæ”¾è¡Œâ€ï¼Œé‚£ä¹ˆä¼šç»§æ‰¿æ‰§è¡Œç”¨æˆ·è¯·æ±‚çš„Servletï¼›å¦‚æœFilterä¸â€œæ”¾è¡Œâ€ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰§è¡Œç”¨æˆ·è¯·æ±‚çš„Servletã€‚
å…¶å®å¯ä»¥è¿™æ ·ç†è§£ï¼Œå½“ç”¨æˆ·è¯·æ±‚æŸä¸ªServletæ—¶ï¼ŒTomcatä¼šå»æ‰§è¡Œæ³¨å†Œåœ¨è¿™ä¸ªè¯·æ±‚ä¸Šçš„Filterï¼Œç„¶åæ˜¯å¦â€œæ”¾è¡Œâ€ç”±Filteræ¥å†³å®šã€‚å¯ä»¥ç†è§£ä¸ºï¼ŒFilteræ¥å†³å®šæ˜¯å¦è°ƒç”¨Servletï¼å½“æ‰§è¡Œå®ŒæˆServletçš„ä»£ç åï¼Œè¿˜ä¼šæ‰§è¡ŒFilteråé¢çš„ä»£ç ã€‚

åº”ç”¨åœºæ™¯
æ‰§è¡Œç›®æ ‡èµ„æºä¹‹å‰åšé¢„å¤„ç†å·¥ä½œï¼Œä¾‹å¦‚è®¾ç½®ç¼–ç ï¼Œè¿™ç§è¯•é€šå¸¸éƒ½ä¼šæ”¾è¡Œï¼Œåªæ˜¯åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œä¹‹å‰åšä¸€äº›å‡†å¤‡å·¥ä½œ
é€šè¿‡æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ”¾è¡Œï¼Œä¾‹å¦‚æ ¡éªŒå½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œæˆ–è€…ç”¨æˆ·IPæ˜¯å¦å·²ç»è¢«ç¦ç”¨ï¼›
åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œåï¼Œåšä¸€äº›åç»­çš„ç‰¹æ®Šå¤„ç†å·¥ä½œï¼Œä¾‹å¦‚æŠŠç›®æ ‡èµ„æºè¾“å‡ºçš„æ•°æ®è¿›è¡Œå¤„ç†ï¼›


======================å®šåˆ¶åŒ–åŸç† SpringBootå®šåˆ¶åŒ–ç»„ä»¶çš„å‡ ç§æ–¹å¼========================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: AdminWebConfig.java
å®šåˆ¶åŒ–åŸç†åˆ†æå¥—è·¯
åœºæ™¯starter - xxxxAutoConfiguration - @Bean å¯¼å…¥xxxç»„ä»¶ - ç»‘å®šxxxProperties -- ç»‘å®šé…ç½®æ–‡ä»¶é¡¹

å®šåˆ¶åŒ–çš„å¸¸è§æ–¹å¼
1ã€ç¼–å†™è‡ªå®šä¹‰çš„é…ç½®ç±»   xxxConfigurationï¼›+ @Bean : æ›¿æ¢ã€å¢åŠ å®¹å™¨ä¸­é»˜è®¤ç»„ä»¶ï¼›è§†å›¾è§£æå™¨
2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼›
3ã€xxxxxCustomizerï¼›
4ã€ğŸŒŸWebåº”ç”¨ ï¼šç¼–å†™ä¸€ä¸ªé…ç½®ç±»å®ç° WebMvcConfigurer å³å¯å®šåˆ¶åŒ–webåŠŸèƒ½ï¼›+ @Beanç»™å®¹å™¨ä¸­å†æ‰©å±•ä¸€äº›ç»„ä»¶ --- ä¾‹å­ï¼šAdminWebConfig.java
       @Configuration
       public class AdminWebConfig implements WebMvcConfigurer

       å¦‚æœæƒ³é‡å†™RequestMappingHandlerMappingè¿™äº›éå¸¸åº•å±‚çš„--WebMvcRegistrations

5ã€@EnableWebMvc + WebMvcConfigurer â€”â€” @Bean  å¯ä»¥å…¨é¢æ¥ç®¡SpringMVCï¼Œæ‰€æœ‰è§„åˆ™å…¨éƒ¨è‡ªå·±é‡æ–°é…ç½®ï¼› å®ç°å®šåˆ¶å’Œæ‰©å±•åŠŸèƒ½


========================æ•°æ®è®¿é—® æ•°æ®åº“åœºæ™¯çš„è‡ªåŠ¨é…ç½®åˆ†æä¸æ•´åˆæµ‹è¯•========================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: pom.xml application.yaml  testä¸‹é¢çš„WebAdminApplicationTests.java
å®šåˆ¶åŒ–åŸç†åˆ†æå¥—è·¯
åœºæ™¯starter - xxxxAutoConfiguration - @Bean å¯¼å…¥xxxç»„ä»¶ - ç»‘å®šxxxProperties -- ç»‘å®šé…ç½®æ–‡ä»¶é¡¹
1ã€å¯¼å…¥JDBCåœºæ™¯
2ã€å¯¼å…¥mysql

åˆ†æè‡ªåŠ¨é…ç½®
1ã€è‡ªåŠ¨é…ç½®çš„ç±»
DataSourceAutoConfiguration ï¼š æ•°æ®æºçš„è‡ªåŠ¨é…ç½®
ä¿®æ”¹æ•°æ®æºç›¸å…³çš„é…ç½®ï¼šspring.datasource
   springbootä½¿ç”¨@ConfigurationProperties(prefix="")åŠ è½½é…ç½®
æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œæ˜¯è‡ªå·±å®¹å™¨ä¸­æ²¡æœ‰DataSourceæ‰è‡ªåŠ¨é…ç½®çš„
åº•å±‚é…ç½®å¥½çš„è¿æ¥æ± æ˜¯ï¼šHikariDataSource


1ã€DataSourceTransactionManagerAutoConfigurationï¼š äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®
2ã€JdbcTemplateAutoConfigurationï¼š JdbcTemplateçš„è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥æ¥å¯¹æ•°æ®åº“è¿›è¡Œcrud
      å¯ä»¥ä¿®æ”¹è¿™ä¸ªç»‘å®šé…ç½®é¡¹@ConfigurationProperties(prefix = "spring.jdbc") æ¥ä¿®æ”¹JdbcTemplate
            @Bean
            @Primary
            JdbcTemplate   ï¼šå®¹å™¨ä¸­æœ‰è¿™ä¸ªç»„ä»¶
3ã€JndiDataSourceAutoConfigurationï¼š jndiçš„è‡ªåŠ¨é…ç½®
4ã€XADataSourceAutoConfigurationï¼š åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„

åœ¨pom.xmlå¼•å…¥ä¾èµ–
åœ¨ application.yaml å†™å¥½é…ç½®
      ||  ||
      ||  ||
       \\ //
åœ¨ WebAdminApplicationTests.java å†™å¥½æµ‹è¯•ç±»

=========================æ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯çš„ä¸¤ç§æ–¹å¼=======================
                         è‡ªå®šä¹‰
                         æ‰¾starter

========================æ•°æ®è®¿é—® è‡ªå®šä¹‰æ–¹å¼æ•´åˆDruidæ•°æ®æº========================
éœ€è¦çš„æ•ˆæœï¼šåœ¨ç™»å½•ä¹‹åï¼Œæœ‰ä¸€ä¸ªç›‘æ§é¡µé¢ï¼Œé‡Œé¢çš„æ¯ä¸ªåŠŸèƒ½éƒ½èƒ½æ˜¾ç¤ºå‡ºå†…å®¹

å®šåˆ¶åŒ–åŸç†åˆ†æå¥—è·¯
åœºæ™¯starter - xxxxAutoConfiguration - @Bean å¯¼å…¥xxxç»„ä»¶ - ç»‘å®šxxxProperties -- ç»‘å®šé…ç½®æ–‡ä»¶é¡¹



Â·Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼š åˆ›å»ºæ•°æ®æº
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:pom.xml ã€application.yaml ã€MyDataSourceConfig.java ã€WebAdminApplicationTests.java
åœ¨pom.xmlå¼•å…¥druidä¾èµ–
      ||  ||
      ||  ||
       \\ //
åˆ›å»ºæ•°æ®æºé…ç½®æ–‡ä»¶ï¼šåœ¨Configä¸‹é¢æ–°å»ºä¸€ä¸ªMyDataSourceConfig.java
       ||  ||
       ||  ||
        \\ //
æ•°æ®æºå±æ€§æ¯”å¦‚ passwordã€usernameè¿™äº›éƒ½åœ¨application.yamlé…å¥½ï¼Œä¸åœ¨MyDataSourceConfig.javaå†™æ­»
   @ConfigurationProperties(prefix = "spring.datasource")
   è¯´æ˜MyDataSourceConfig.javaä¸­ DuridDataSource é‡Œé¢çš„å±æ€§å’Œapplication.yamlæ–‡ä»¶ springçš„datasourceä¸€ä¸€ç»‘å®š
      ||  ||
      ||  ||
       \\ //
åœ¨ WebAdminApplicationTests.java æµ‹è¯•

Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼šç›‘æ§é¡µé¢ä¸­SQLç›‘æ§ï¼Œä½¿è¿è¡Œæ—¶å€™SQLç›‘æ§æ˜¾ç¤ºå†…å®¹
StatViewServletçš„ç”¨é€”åŒ…æ‹¬ï¼š
æä¾›ç›‘æ§ä¿¡æ¯å±•ç¤ºçš„htmlé¡µé¢
æä¾›ç›‘æ§ä¿¡æ¯çš„JSON API

ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: MyDataSourceConfig.java ã€  IndexController.java

åœ¨MyDataSourceConfig.javaé…ç½®StatViewServlet
      ||  ||
      ||  ||
       \\ //
 IndexController.java--è®¿é—®/sqlï¼Œç›´æ¥å¯ä»¥çœ‹åˆ°ç›‘æ§æ•°æ®
       ||  ||
       ||  ||
        \\ //
 åœ¨MyDataSourceConfig.java
 æ‰“å¼€druidç›‘æ§ç»Ÿè®¡åŠŸèƒ½--StatFilter
 æ•ˆæœï¼šåŒæ—¶æ‰“å¼€localhost:8080/druid/sql.htmlå’Œlocalhost:8080/sqlï¼Œä¸æ–­åˆ·æ–°localhost:8080/sqlé¡µé¢ï¼Œç‚¹å‡»localhost:8080/druid/sql.htmlä¸­ä¸Šæ–¹çš„SQLç›‘æ§

Â·Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼šç›‘æ§é¡µé¢ä¸­Webåº”ç”¨ï¼Œä½¿è¿è¡Œæ—¶å€™Webåº”ç”¨æ˜¾ç¤ºå†…å®¹
å†…ç½®ç›‘æ§ä¸­çš„webå’ŒSpringå…³è”ç›‘æ§é…ç½®-- WebStatFilter
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:MyDataSourceConfig.java

æ­¥éª¤ï¼šåœ¨MyDataSourceConfig.javaé…ç½®WebStatFilterï¼Œå¹¶ä¸”åœ¨AdminWebConfigé‡Œé¢çš„æ‹¦æˆªå™¨é‚£é‡Œæ”¾è¡Œ/sqlï¼Œå…å¾—è€æ˜¯è¦ç™»å½•
æ•ˆæœï¼šåŒæ—¶æ‰“å¼€localhost:8080/druid/sql.htmlå’Œlocalhost:8080/sqlï¼Œä¸æ–­åˆ·æ–°localhost:8080/sqlé¡µé¢ï¼Œ
ç‚¹å‡»localhost:8080/druid/sql.htmlä¸­ä¸Šæ–¹çš„Webåº”ç”¨å’ŒURLåº”ç”¨éƒ½æ˜¾ç¤ºå†…å®¹

Â·Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼šç›‘æ§é¡µé¢ä¸­SQLé˜²ç«å¢™
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:MyDataSourceConfig.java

æ­¥éª¤ï¼šåœ¨MyDataSourceConfig.java
   æ·»åŠ é˜²ç«å¢™ï¼šdruidDataSource.setFilters("stat",wall");

Â·Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼šç›‘æ§é¡µé¢ä¸­Springç›‘æ§
Â·Â·Â·Â·Â·Â·Â·Â·
è‡ªå®šä¹‰ï¼šç›‘æ§é¡µé¢éœ€è¦ç™»å½•ï¼Œå¹¶ä¸”é™å®šå“ªäº›åœ°å€èƒ½ç™»å½•
åœ¨MyDataSourceConfig.java
  registrationBean.addInitParameter("loginUsername","admin");
  registrationBean.addInitParameter("loginPassword","12345");

========================æ•°æ®è®¿é—®  druidæ•°æ®æºä½¿ç”¨starteræ•´åˆ========================
æœ‰äº†starterï¼Œä¸Šé¢è‡ªå®šä¹‰çš„éƒ½å¯ä»¥æ³¨é‡Šæ‰ ç­‰åŒäº MyDataSourceConfig.javaæ²¡æœ‰ç”¨

ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:pom.xml  application.yaml
ğŸŒŸæ­¥éª¤ï¼š
1ã€ç›´æ¥åœ¨pom.xmlæ–‡ä»¶å¼•å…¥ä¾èµ–ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹çš„DruidDataSourceAutoConfigure.java

  æ‰©å±•é…ç½®é¡¹ spring.datasource.druid
  1ã€@Import({DruidSpringAopConfiguration.class, DruidStatViewServletConfiguration.class, DruidWebStatFilterConfiguration.class, DruidFilterConfiguration.class})
   åˆ†æè‡ªåŠ¨é…ç½®
   ï¼ˆ1ï¼‰DruidSpringAopConfiguration.class ---ç›‘æ§SpringBeançš„ï¼›
             é…ç½®é¡¹ï¼šspring.datasource.druid.aop-patterns

              @ConditionalOnProperty({"spring.datasource.druid.aop-patterns"})

   ï¼ˆ2ï¼‰DruidStatViewServletConfiguration.class, ç›‘æ§é¡µçš„é…ç½®ï¼š
              spring.datasource.druid.stat-view-servletï¼›é»˜è®¤å¼€å¯

              @ConditionalOnProperty(
                  name = {"spring.datasource.druid.stat-view-servlet.enabled"},
                  havingValue = "true"
              )
   ï¼ˆ3ï¼‰DruidWebStatFilterConfiguration.class, webç›‘æ§é…ç½®ï¼›
               spring.datasource.druid.web-stat-filterï¼›é»˜è®¤å¼€å¯

               @ConditionalOnProperty(
                   name = {"spring.datasource.druid.web-stat-filter.enabled"},
                   havingValue = "true"
               )
   ï¼ˆ4ï¼‰DruidFilterConfiguration.class}) æ‰€æœ‰Druidè‡ªå·±filterçš„é…ç½®ï¼šæ¯”å¦‚é˜²ç«å¢™

              private static final String FILTER_STAT_PREFIX = "spring.datasource.druid.filter.stat";
              private static final String FILTER_CONFIG_PREFIX = "spring.datasource.druid.filter.config";
              private static final String FILTER_ENCODING_PREFIX = "spring.datasource.druid.filter.encoding";
              private static final String FILTER_SLF4J_PREFIX = "spring.datasource.druid.filter.slf4j";
              private static final String FILTER_LOG4J_PREFIX = "spring.datasource.druid.filter.log4j";
              private static final String FILTER_LOG4J2_PREFIX = "spring.datasource.druid.filter.log4j2";
              private static final String FILTER_COMMONS_LOG_PREFIX = "spring.datasource.druid.filter.commons-log";
              private static final String FILTER_WALL_PREFIX = "spring.datasource.druid.filter.wall";
              private static final String FILTER_WALL_CONFIG_PREFIX = "spring.datasource.druid.filter.wall.config";


          ||  ||
          ||  ||
           \\ //
   2ã€æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨application.yamlå®ç°

========================æ•°æ®è®¿é—®  æ•´åˆmybatis xmlé…ç½®========================
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶:pom.xml  application.yaml  AccountMappper.java  Account.java
               AccountMapper.xml  mybatis-config.xml IndexController.java

@EnableConfigurationProperties(MybatisProperties.class) ï¼š MyBatisé…ç½®é¡¹ç»‘å®šåˆ°ç±»MybatisProperties.classä¸Š
é…ç½®æ¨¡å¼
å…¨å±€é…ç½®æ–‡ä»¶
SqlSessionFactory: è‡ªåŠ¨é…ç½®å¥½äº†
SqlSessionï¼šè‡ªåŠ¨é…ç½®äº† SqlSessionTemplate ç»„åˆäº†SqlSession
@Import(AutoConfiguredMapperScannerRegistrar.classï¼‰ï¼›
Mapperï¼š åªè¦æˆ‘ä»¬å†™çš„æ“ä½œMyBatisçš„æ¥å£æ ‡äº† @Mapper å°±ä¼šè¢«è‡ªåŠ¨æ‰«æè¿›æ¥

Mapperæ¥å£--->ç»‘å®šXml

åœ¨pom.xmlå¼•å…¥mybatis
          ||  ||
          ||  ||
           \\ //
åœ¨application.yamlå†™æƒ³ä¿®æ”¹çš„mybatisé…ç½®
åœ¨resourceä¸‹é¢æ–°å»ºä¸€ä¸ªmybatisï¼Œåˆ›å»ºä¸€ä¸ªmybatis-config.xmlï¼ˆmybatiså…¨å±€é…ç½®æ–‡ä»¶ï¼‰
              --ç”¨æ¥åœ¨application.yaml
          ||  ||
          ||  ||
           \\ //
åœ¨mybatisä¸‹é¢æ–°å»ºmapperï¼Œæ“ä½œæ•°æ®åº“
          ||  ||
          ||  ||
           \\ //
  mybatisæ“ä½œæ•°æ®åº“ï¼Œè¦å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£æ–‡ä»¶AccountMappperï¼ˆåœ¨package com.example.admin;ä¸‹é¢æ–°å»ºmapperï¼Œç”¨æ¥æ”¾AccountMappper.javaï¼‰
  å®ƒä¸“é—¨æ“ä½œæ•°æ®åº“çš„è¡¨account_db
  AccountMappperé‡Œé¢å†™æ–¹æ³•
   *   è¿”å›è´¦å·ä¿¡æ¯ åœ¨beanä¸‹é¢æ–°åˆ›å»ºå®ä½“ç±»Account.java,
              ä¸‹é¢ä¸‰ä¸ªå±æ€§æ˜¯çœ‹ç€SQLä¸­çš„account_dbé‡Œé¢çš„å­—æ®µæ¥å†™  int---Long  varchar---String
             ||  ||
             ||  ||
              \\ //
    AccountMappperé‡Œé¢çš„æ–¹æ³•å®ç°è¦åœ¨xmlæ–‡ä»¶ä¸­ï¼Œåœ¨resourceä¸‹é¢çš„mapperä¸‹é¢å‡†å¤‡ä¸€ä¸ªSQLæ˜ å°„æ–‡ä»¶AccountMapper.xml
    AccountMapper.xmlå†™æŸ¥è¯¢æ–¹æ³•
               ||  ||
               ||  ||
                \\ //
    å›åˆ°application.yaml æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶ä½ç½®ï¼Œsqlæ˜ å°„æ–‡ä»¶ä½ç½®
               ||  ||
               ||  ||
                \\ //
    è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨äº†ï¼Œå»IndexControlleré‡Œé¢å†™ä¸€ä¸ªæ–¹æ³•æµ‹è¯•
    è´¦å·å†…å®¹ä¿¡æ¯é€šè¿‡æ¥å£æ–‡ä»¶AccountMapper.javaå¾—åˆ°çš„--å¯ä»¥è‡ªåŠ¨æ³¨å…¥--ä½†æ˜¯å¼€å‘æ˜¯ç”¨serviceè°ƒç”¨çš„
                ||  ||
                ||  ||
                 \\ //
    åœ¨com.example.adminæ–°åˆ›å»ºä¸€ä¸ªserviceä¸‹é¢çš„AccountService
    è°ƒç”¨AccountMapper.java
                 ||  ||
                 ||  ||
                  \\ //
    å»IndexControlleræµ‹è¯•
    controllerè°ƒç”¨serviceï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼‰ï¼Œserviceè°ƒç”¨mapper
                 ||  ||
                 ||  ||
                  \\ //
    è®¿é—®http://localhost:8080/acct?id=1èƒ½è·å–æ•°æ®åº“çš„å†…å®¹

å°ç»“ï¼š
  å¯¼å…¥mybatiså®˜æ–¹starter
  ç¼–å†™mapperæ¥å£ã€‚æ ‡å‡†@Mapperæ³¨è§£
  ç¼–å†™sqlæ˜ å°„æ–‡ä»¶å¹¶ç»‘å®šmapperæ¥å£
  åœ¨application.yamlä¸­æŒ‡å®šMapperé…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œä»¥åŠæŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ ï¼ˆå»ºè®®ï¼›é…ç½®åœ¨mybatis.configurationï¼‰


========================æ•°æ®è®¿é—®  æ•´åˆmybatis çº¯æ³¨è§£ç‰ˆ========================
ä¸ç”¨xmlé…ç½®
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: City.java CityMapper.java  CityService.java IndexController.java

         Create sql files
         å»mysqlåˆ›å»ºä¸€ä¸ªè¡¨
                 ||  ||
                 ||  ||
                  \\ //
         Create a domain class
         åœ¨beanä¸‹é¢åˆ›å»ºä¸€ä¸ªå®ä½“ç±»domain class-- City.java --å°è£…è¡¨é‡Œé¢çš„æ•°æ®
                 ||  ||
                 ||  ||
                  \\ //
         Create a mapper interface åœ¨mapperä¸‹é¢æ–°å»ºCityMapper.java
                 ||  ||
                 ||  ||
                  \\ //
         æ–°å»ºä¸€ä¸ªserviceè°ƒç”¨CityMapper -- CityService.java
                 ||  ||
                 ||  ||
                  \\ //
             å»IndexControlleræµ‹è¯•
                 ||  ||
                 ||  ||
                  \\ //
          è®¿é—®http://localhost:8080/city?id=1è·å–æ•°æ®åº“çš„å†…å®¹

============æ··åˆä½¿ç”¨é…ç½®å’Œæ³¨è§£
å‡è®¾åœ¨CityMapperé‡Œé¢è¿˜å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼šSQLè¯­å¥å¾ˆéº»çƒ¦
ğŸŒŸğŸŒŸğŸŒŸğŸŒŸç”¨åˆ°çš„æ–‡ä»¶: City.java CityMapper.java  CityService.java IndexController.java city.html

 CityMapper.javaé‡Œé¢å®šä¹‰ä¸€ä¸ªinsertæ–¹æ³•ï¼ŒSQLè¯­å¥å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªCityMapper.xmlå†™SQLè¯­å¥
                  ||  ||
                  ||  ||
                   \\ //
      åœ¨ CityServiceå®šä¹‰ä¸€ä¸ªsaveCity()
                  ||  ||
                  ||  ||
                   \\ //
          å»IndexControlleræµ‹è¯•
      ç”±äºæ˜¯postMappingè¯·æ±‚ï¼Œå†™formè¡¨å•--é¡µé¢æ˜¯city.html

============å¤æ‚çš„SQLè¯­å¥ ä½¿ç”¨æ³¨è§£
insertæ–¹æ³•è¿˜æ˜¯ç”¨æ³¨è§£å†™

       æ³¨é‡Šæ‰CityMapper.xmlæ–‡ä»¶
                  ||  ||
                  ||  ||
                   \\ //
            CityMapperä½¿ç”¨æ³¨è§£@Insert

æœ€ä½³å®æˆ˜ï¼š
1ã€å¼•å…¥mybatis-starter
2ã€é…ç½®application.yamlä¸­ï¼ŒæŒ‡å®šmapper-locationä½ç½®å³å¯
3ã€ç¼–å†™Mapperæ¥å£å¹¶æ ‡æ³¨@Mapperæ³¨è§£
4ã€ç®€å•æ–¹æ³•ç›´æ¥æ³¨è§£æ–¹å¼
5ã€å¤æ‚æ–¹æ³•ç¼–å†™mapper.xmlè¿›è¡Œç»‘å®šæ˜ å°„
åœ¨WebAdminApplication.java
   @MapperScan("com.example.admin.mapper") ç®€åŒ–ï¼Œom.example.admin.mapperä¸‹é¢çš„mapperéƒ½è¢«æ‰«æåˆ°ï¼Œå…¶ä»–çš„æ¥å£å°±å¯ä»¥ä¸ç”¨æ ‡æ³¨@Mapperæ³¨è§£

========================